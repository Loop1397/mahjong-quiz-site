<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main Page</title>
    <link rel="stylesheet" href="./css/index.css">
    <script>
        /**
        * 마작 패 리스트
        * 0~8 : 만
        * 9~17 : 통
        * 18~26 : 삭
        * 27~33 : 동, 남, 서, 북, 백, 발, 중
        */
        const tileImgList = [
            "1m.png",
            "2m.png",
            "3m.png",
            "4m.png",
            "5m.png",
            "6m.png",
            "7m.png",
            "8m.png",
            "9m.png",
            "1p.png",
            "2p.png",
            "3p.png",
            "4p.png",
            "5p.png",
            "6p.png",
            "7p.png",
            "8p.png",
            "9p.png",
            "1s.png",
            "2s.png",
            "3s.png",
            "4s.png",
            "5s.png",
            "6s.png",
            "7s.png",
            "8s.png",
            "9s.png",
            "1z.png",
            "2z.png",
            "3z.png",
            "4z.png",
            "5z.png",
            "6z.png",
            "7z.png"
        ];
        // 현재 패산에 있는 각각의 패가 몇개 남았는지 들어있는 배열
        const currentDeckCount = Array.from({length: 34}, () => 0);
        // 현재 패산에 있는 패의 순서(스택형)
        const currentDeckList = [];
        // 손에 갖고있는 패
        const handTileArr = [];
        // 왕패(사용되지 않는 14장의 패. 도라 및 뒷도라로 공개될때도 사용 됨)
        const kingTileArr = [];

        window.onload = () => {
            const boardDiv = document.querySelector("#board");
            for(i=0; i<13; i++) {
                boardDiv.insertAdjacentHTML("beforeend", `<div class="tile" ><img src=./img/back.png></div>`);
            }
        }

        // 0~ max-1 사이의 정수를 랜덤으로 가져오는 함수
        getRandomInteger = (max) => {
            const result = Math.floor(Math.random() * max);
            return result;
        }

        // 패를 섞어 패산을 만하는 함수
        // 피셔-예이츠 셔플 알고리즘 이용
        shuffle = () => {
            // currentDeckCount의 모든 요소를 4로 만듦
            currentDeckCount.fill(4);
            // 패산List, 손패, 왕패 배열 초기화
            currentDeckList.length = 0;
            handTileArr.length = 0;
            kingTileArr.length = 0;

            console.log("shuffle!!");

            // currentDeckList에 0부터 33까지 4개씩 push함
            for(let i = 0; i < 33 * 4; i++) {
                currentDeckList.push(Math.floor(i/4));
            }

            /*
            while (i < 13) {
                let draw = getRandomInteger(34);

                if (currentDeckCount[draw] < 4) {
                    currentDeckCount[draw] += 1;
                    i += 1;
                    handTileArr.push(draw);
                } 
            }*/

            // 피셔-에이츠 셔플 알고리즘으로 패산 섞기
            for(let i = 33 * 4 - 1; i > 0; i--) {
                const changeNumber = getRandomInteger(i-1);
                [currentDeckList[i], currentDeckList[changeNumber]] = [currentDeckList[changeNumber], currentDeckList[i]];
            }

            // 14개의 왕패 빼기
            for(let i = 0; i < 14; i++) {
                // Array.shift : 배열의 맨 앞에서 pop. shift의 반대는 unshift
                let draw = currentDeckList.shift();
                currentDeckCount[draw] -= 1;
                kingTileArr.push(draw);
            }

            // 13개의 손패 배부
            for(let i = 0; i < 13; i++) {
                let draw = currentDeckList.pop();
                currentDeckCount[draw] -= 1;
                handTileArr.push(draw);
            }
            
            //최종 결과 프린트
            // sort는 배열 내용물 자체를 변환
            // toSorted는 복사한 배열을 반환(원본 배열의 내용은 변하지 않음)
            printDeck(handTileArr.sort((a, b) => a-b));
        }


        /* tileChange = (index) => {
            console.log(index);

            let draw = getRandomInteger(34);
            handTileArr[index] = ;
        } */

        printDeck = (tileArr) => {
            const boardDiv = document.querySelector("#board");
            boardDiv.innerHTML = "";

            tileArr.forEach((tile, index) => {
                boardDiv.insertAdjacentHTML("beforeend", `<div class="tile"  onclick="tileChange(${index})"><img id="tile${index}" src=./img/${tileImgList[tile]}></div>`);
            });
        }

    </script>
</head>
<body>
    <header>
        
    </header>
    <main>
        <div id="board">
        </div>
        <div id="shuffle-button">
            <button onclick="shuffle()">섞기</button>
        </div>
    </main>
</body>
</html>